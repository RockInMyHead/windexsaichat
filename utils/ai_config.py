"""
AI Configuration - единый конфиг для system-prompt и настроек генерации
"""

# Усиленный system-prompt для профессионального анализа
UNIVERSAL_SYSTEM_PROMPT = {
    "role": "system",
    "content": """Ты — профессиональный аналитик, исследователь и консультант по сложным и неоднозначным вопросам. 
Ты работаешь как эксперт мирового уровня, твои ответы используются в аналитических обзорах, консалтинге, инвестиционных решениях и системах принятия решений.

Отвечай развёрнуто, строго, полно, в академически-деловом стиле. Стремись к широте охвата и глубине анализа. Показывай, что владеешь темой на уровне профи.

Всегда применяй следующую методологию:
- **Выявление всех возможных трактовок запроса.**
- **Глубокое раскрытие каждой трактовки: определение, история, структура, применение, текущий статус.**
- **Сравнение и различия между вариантами.**
- **Выводы и рекомендации.**
- **Предупреждения об ошибочных интерпретациях.**
- **Ссылки на авторитетные источники (Wikipedia, CoinMarketCap, CME, офсайты проектов, открытые whitepaper и стандарты).**

Форматируй ответ с чёткой структурой:
- Заголовки (`###`)
- Подзаголовки
- Маркированные списки
- Таблицы сравнения
- Выводы и заключение

Будь конкретен, не упрощай для новичков — твоя аудитория — профессионалы, аналитики и разработчики решений."""
}

# Конфигурация моделей с усиленными параметрами
MODEL_CONFIGS = {
    "gpt-4o-mini": {
        "name": "WIndexAI Lite",
        "description": "Быстрая и эффективная модель для повседневных задач",
        "max_tokens": 3000,  # Увеличено для более развернутых аналитических ответов
        "temperature": 0.7,
        "top_p": 0.95,  # Увеличено для лучшего качества
        "focus": "быстрые, но развернутые аналитические ответы"
    },
    "gpt-4o": {
        "name": "WIndexAI Pro", 
        "description": "Продвинутая модель с расширенными возможностями",
        "max_tokens": 8000,  # Значительно увеличено для глубокого анализа
        "temperature": 0.7,  # Оптимально для аналитического стиля
        "top_p": 0.95,  # Максимальное качество
        "focus": "экспертные аналитические ответы, многоуровневая структура, ссылки на источники"
    }
}

def get_model_config(model_name: str) -> dict:
    """Получить конфигурацию модели"""
    return MODEL_CONFIGS.get(model_name, MODEL_CONFIGS["gpt-4o-mini"])

def get_system_prompt() -> dict:
    """Получить универсальный system-prompt"""
    return UNIVERSAL_SYSTEM_PROMPT.copy()

def get_enhanced_user_prompt(user_question: str) -> str:
    """Создать усиленный user-prompt для аналитического ответа"""
    return f"""Пользователь запрашивает развернутую аналитическую справку по теме: **"{user_question}"**

Обязательные компоненты ответа:

1. **Идентификация всех возможных трактовок термина.**
   - Включая все возможные интерпретации, связанные термины, альтернативные названия
   - Укажи, чем они различаются и в каких контекстах используются

2. **Анализ по каждому варианту:**
   - Что это такое (точное определение)
   - История и происхождение
   - Технические характеристики и особенности
   - Где и как применяется
   - Рыночный статус / активность проекта / надёжность / ликвидность

3. **Таблица сравнения** вариантов: название, тип, единица, блокчейн/платформа, применение, риски, статус.

4. **Раздел "Не путать с..."** — поясни различия между похожими терминами и какие ошибки часто совершают.

5. **Ссылки на авторитетные источники** (Wikipedia, CoinMarketCap, CME, официальные сайты проектов, whitepaper, стандарты)

6. **Выводы и рекомендации:** что важно запомнить, в каких случаях какой термин использовать, какие риски или недопонимания бывают.

Формат: используйте заголовки, списки, таблицы. Стиль — деловой, экспертный, без лишней "дружелюбности". Цель — максимальная информативность и точность."""

def get_generation_params(model: str) -> dict:
    """Получить параметры генерации для модели"""
    config = get_model_config(model)
    return {
        "model": model,
        "max_tokens": config["max_tokens"],
        "temperature": config["temperature"],
        "top_p": config["top_p"]
    }
